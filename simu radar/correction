#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Fri Apr  9 16:00:02 2021

@author: kdesousa
"""
import pandas as pd
import numpy as np
def correction(vect1,vect2,dt=1/30,dx = 0.022,dy = 0.04,f0=24e9):
    print(vect2)
    theta_rad,phi_rad = vect2[5:7]
    theta_cam,phi_cam = vect2[1:3]
    
    pitch= -12.999994000000001
    yaw = -2.5
    
    lam = 3e8/f0 
    ambphi = lam*180/(dx*np.pi) #32.554420177887685 
    ambtheta = lam*180/(dy*np.pi)#17.904931097838226
    #nx = np.rint(phi_cam/ambphi)
    #ny = np.rint(theta_cam/ambtheta)
    
    #phi_rad += (nx)*ambphi
    #theta_rad += (ny)*ambtheta
    while( phi_cam - phi_rad > ambphi/2):
        phi_rad += ambphi
    while(theta_cam - theta_rad >ambtheta/2) :
        theta_rad += ambtheta
        
    #d,theta,phi,v
   
    vectcor = vect2
    vectcor[5:7] = [theta_rad+pitch,phi_rad+yaw]
    
    d = vect2[4]
    v = vect2[7]
    theta1 = vect1[5]
    theta2 = vect2[5]
    phi1 = vect1[6]
    phi2 = vect2[6]
    vabs = v + d*(theta2 - theta1)/dt + d * np.sin(theta2)* (phi2 - phi1)/dt
    
    vectcor[7]=v / np.cos(phi_rad*np.pi/180)
    
    return vectcor

if __name__ == '__main__':
   dataxee = pd.read_csv('data_est.csv',sep=';').values
   data = pd.read_csv('data.csv')
   
   #z = correction(dataxee[5,:],dataxee[180,:])
   test = [50.04259141, 100.18920533 , -9.65049533,   4.51801254,51.6  , 22.84473873 , 7.58032977 , 4.71959114]
   test1 = [53.65866701  ,99.45476918 , 11.11492916 ,  3.91262277,    55.5      ,  30.91230297 ,14.56012987 , 4.06861305]
   test2 = [  60.38150068,  73.58789653 ,-139.16374612  , -0.37593968,60.   ,       0.67408354 ,14.7688213 , -0.48823357]
   test3 = [50.04259141 ,  75.69071883 ,-153.0433467   ,  4.00413374,50.7   ,     13.84025417, 10.47155506,  4.23135757]
   z = correction(dataxee[5,:],dataxee[420,:])
   print(z)
   